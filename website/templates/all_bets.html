{% extends "base.html" %}

{% block title %}EV Betting{% endblock %}

{% block content %}
<table>
    <thead> <!-- Fixed typo: was <thread> -->
        <tr>
            <th>Date</th>
            <th>Team</th>
            <th>Sport</th>
            <th>Bookie</th>
            <th>Odds</th>
            <th>Type</th>
            <th>Amount</th>
            <th>EV</th>
            <th>Outcome</th>
            <th>Edit</th>
        </tr>
    </thead>
    <tbody>
        {% for bet in bets %}
        <tr>
            <td>{{bet.date}} </td>
            <td>{{bet.team}} </td>
            <td>{{bet.sport}}</td>
            <td>{{bet.bookie}}</td>
            <td>{{bet.odds}}</td>
            <td>{{bet.bet_type}}</td>
            <td>{{bet.bet_amount}}</td>
            <td>{{bet.this_EV}}</td>
            <td class="{{bet.outcome|lower}}">{{bet.outcome}}</td>
            <td>
                <!-- MODIFIED BUTTON: Added all data attributes -->
                <button class="btn btn-primary edit-bet-btn" 
                        data-bet-id="{{ bet.bet_id }}" 
                        data-odds="{{ bet.odds }}" 
                        data-date="{{ bet.date }}"
                        data-amount="{{ bet.bet_amount }}"
                        data-team="{{ bet.team }}"
                        data-sport="{{ bet.sport }}"
                        data-bookie="{{ bet.bookie }}"
                        data-outcome="{{ bet.outcome }}">
                    Update
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="modal fade" id="editBetModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <!-- MODIFIED TITLE: Added id="editBetModalTitle" -->
                <h5 class="modal-title" id="editBetModalTitle">Update Bet</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editBetForm" method="POST" action="{{ url_for('edit_bet') }}">
                    <input type="hidden" name="bet_id" id="modal-bet-id">

                    <!-- NEW FIELD: Read-only Team -->
                    <div class="mb-3">
                        <label for="modal-team" class="form-label">Team:</label>
                        <input type="text" name="team" id="modal-team" class="form-control" readonly>
                    </div>

                    <!-- NEW FIELD: Read-only Sport -->
                    <div class="mb-3">
                        <label for="modal-sport" class="form-label">Sport:</label>
                        <input type="text" name="sport" id="modal-sport" class="form-control" readonly>
                    </div>

                    <div class="mb-3">
                        <label for="odds" class="form-label">Edit Odds:</label>
                        <input type="number" name="odds" id="modal-odds" class="form-control" value=0>
                    </div>

                    <div class="mb-3">
                        <label for="date" class="form-label">Edit Date:</label>
                        <input type="date" name="date" id="modal-date" class="form-control" value="">
                    </div>

                    <div class="mb-3">
                        <label for="amount" class="form-label">Edit Amount:</label>
                        <input type="number" name="amount" id="modal-amount" class="form-control" step="any" value=0>
                    </div>

                    <!-- NEW FIELD: Added Bookie dropdown -->
                    <div class="mb-3">
                        <label for="bookie" class="form-label">Edit Bookie:</label>
                        <select name="bookie" id="modal-bookie" class="form-select">
                            <option value="draftkings">draftkings</option>
                            <option value="fanduel">fanduel</option>
                            <option value="betmgm">betmgm</option>
                            <option value="betrivers">betrivers</option>
                            <option value="ballybet">ballybet</option>
                            <option value="espnbet">espnbet</option>
                            <option value="fanatics">fanatics</option>
                            <option value="williamhill_us">williamhill</option>
                        </select>
                    </div>

                    <!-- **** MODIFIED OUTCOME SECTION **** -->
                    <div class="mb-3">
                        <label class="form-label">Update Outcome:</label>
                        <!-- Each button has type="submit" and sends its own value for the 'outcome' field -->
                        <div class="d-grid gap-2">
                            <button type="submit" name="outcome" value="win" class="btn btn-success">Win</button>
                            <button type="submit" name="outcome" value="loss" class="btn btn-danger">Loss</button>
                            <button type="submit" name="outcome" value="Pending" class="btn btn-secondary">Pending</button>
                            <button type="submit" name="outcome" value="cancelled" class="btn btn-warning">Cancelled</button>
                        </div>
                    </div>
                    <!-- **** END OF MODIFIED SECTION **** -->

                </form>
            </div>
        </div>
    </div>
</div>

<!-- MODIFIED SCRIPT -->
<script>
    $(document).ready(function() {
        $(".edit-bet-btn").click(function() {
            // Get all data from the button
            let betId = $(this).data("bet-id");
            let odds = $(this).data("odds");
            let date = $(this).data("date");
            let amount = $(this).data("amount");
            let bookie = $(this).data("bookie");   // New
            let team = $(this).data("team");       // New
            let sport = $(this).data("sport");     // New
            // 'outcome' is no longer needed here

            // Set the modal title (New)
            $("#editBetModalTitle").text("Update Bet: " + team); 

            // Set values for all form fields
            $("#modal-bet-id").val(betId);
            $("#modal-team").val(team);       // New
            $("#modal-sport").val(sport);     // New
            $("#modal-odds").val(odds);
            $("#modal-date").val(date);
            $("#modal-amount").val(amount);
            $("#modal-bookie").val(bookie);   // New
            // The line for #modal-outcome has been removed

            $("#editBetModal").modal("show"); 
        });
    });
</script>
{% endblock %}